 <html>
 <script type="text/javascript">
    class View {
        constructor(ctx, width, height) {
            this.ctx = ctx;
            this.width = width;
            this.height = height;
            this.offset = 10;
            this.lineLeft = new Line(true, 100, width, this.offset, width-this.offset);
            this.lineRight = new Line(true, 300, width, this.offset, width-this.offset);
            this.lineTop = new Line(false, 100, height, this.offset, height-this.offset);
            this.lineBottom = new Line(false, 300, height, this.offset, height-this.offset);
            this.lines = [this.lineLeft,
                          this.lineRight,
                          this.lineTop,
                          this.lineBottom];
            
            this.currentLine = null;
            this.imageObj = new Image();
            this.imageObj.src = 'https://3.bp.blogspot.com/-gA8KyZv9Zbo/VKKtQbVwDjI/AAAAAAAAAg4/UFNT6TATiTE/s1600/19858_adventure_time.jpg';
            this.drawImage();
        }
        drawImage() {
            this.ctx.drawImage(this.imageObj, 0, 0, 400, 400);
            this.lines.forEach(line => {
                this.ctx.setLineDash([5, 3]);
                line.draw(this.ctx);
            });
            this.ctx.globalAlpha=0.4;
            this.ctx.fillRect(0, 0, this.lineLeft.pos, 5000);
            this.ctx.fillRect(this.lineLeft.pos, 0, this.lineRight.pos-this.lineLeft.pos, this.lineTop.pos);
            this.ctx.fillRect(this.lineRight.pos, 0, 5000, 5000);
            this.ctx.fillRect(this.lineLeft.pos, this.lineBottom.pos, this.lineRight.pos-this.lineLeft.pos, 5000);
        }
        move(evt) {
            if(this.currentLine) {
                this.currentLine.move(getMousePos(canvas, evt).x, getMousePos(canvas, evt).y);
                this.drawImage();
            }
        }
        mouseDown(evt) {
            this.lines.forEach(line => {
                if(line.isUnderMouse(getMousePos(canvas, evt).x, getMousePos(canvas, evt).y)) {
                    this.currentLine = line;
                }
            });
        }
        mouseUp() {
            this.currentLine = null;
            this.drawImage();
        }
    } 
    
    class Line {
        constructor(vertical, pos, length, posMin, posMax) {
            this.vertical = vertical;
            this.pos = pos;
            this.length;
            this.x1 = 0;
            this.y1 = 0;
            this.x2 = 0;
            this.y2 = 0;
            this.posMin = posMin;
            this.posMax = posMax;
            if(vertical) {
                this.x1 = pos;
                this.x2 = pos;
                this.y2 = length;
            } else {
                this.y1 = pos;
                this.y2 = pos;
                this.x2 = length;
            }
        }
        draw(ctx) {
        ctx.beginPath();
            ctx.moveTo(this.x1, this.y1);
            ctx.lineTo(this.x2, this.y2);
            ctx.strokeStyle = x;
            ctx.lineWidth = y;
            ctx.stroke();
            ctx.closePath();
        }
        move(x, y) {
            var newPos = 0;
            if(this.vertical) {
                newPos = x;
            } else {
                newPos = y;
            }
            if(newPos > this.posMin && newPos < this.posMax) {
                if(this.vertical) {
                    this.pos = x;
                    this.x1 = x;
                    this.x2 = x;
                } else {
                    this.pos = y;
                    this.y1 = y;
                    this.y2 = y;
                }
            }
        }
        isUnderMouse(x, y) {
            var offset = 5;
            var ret = this.x1-offset<x &&
                this.x2+offset>x &&
                this.y1-offset<y &&
                this.y2+offset>y;
            return ret;
        }
    }  
     
     var canvas, ctx, flag = false,
         prevX = 0,
         currX = 0,
         prevY = 0,
         currY = 0,
         dot_flag = false
         view = null;

     var x = "black",
         y = 2;

     function init() {
         canvas = document.getElementById('can');
         ctx = canvas.getContext("2d");
         w = canvas.width;
         h = canvas.height;
         view = new View(ctx, canvas.width-10, canvas.height-10);

         canvas.addEventListener("mousemove", function(e) {
             view.move(e);
         }, false);
         canvas.addEventListener("mousedown", function(e) {
             view.mouseDown(e);
         }, false);
         canvas.addEventListener("mouseup", function(e) {
             view.mouseUp();
         }, false);
         //canvas.addEventListener("mouseout", function(e) {
        //     view.mouseUp();
         //}, false);
     }

     function getMousePos(canvas, evt) {
        var rect = canvas.getBoundingClientRect();
        return {
            x: evt.clientX - rect.left,
            y: evt.clientY - rect.top
        };
     }

 </script>

 <body onload="init()">
     <canvas id="can" width="400" height="400" style="position:absolute;top:10%;left:10%;border:2px solid;">Nie mogę załadować canvas'a/canvas'u</canvas>
     <img id="canvasimg" style="position:absolute;top:10%;left:52%;" style="display:none;">
 </body>

 </html>
